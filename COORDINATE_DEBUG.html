<!DOCTYPE html>
<html>
<head>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #0a1628;
            color: white;
            font-family: monospace;
        }
        
        #container {
            display: grid;
            grid-template-columns: 200px 1fr 250px;
            gap: 20px;
            height: 80vh;
        }
        
        .panel {
            background: rgba(36, 36, 62, 0.95);
            border-radius: 15px;
            padding: 12px;
            border: 2px solid rgba(255, 107, 157, 0.2);
        }
        
        #center-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        #level-info {
            padding: 10px 15px;
            background: rgba(255, 107, 157, 0.1);
            border-radius: 10px;
            border: 2px solid rgba(255, 107, 157, 0.3);
        }
        
        #canvas {
            flex: 1;
            background: rgba(42, 74, 106, 0.5);
            border: 3px solid #4ecdc4;
            border-radius: 15px;
            position: relative !important;
            overflow: hidden;
            cursor: crosshair;
        }
        
        .debug-marker {
            position: absolute;
            width: 8px;
            height: 8px;
            background: red;
            border-radius: 50%;
            transform: translate(-4px, -4px); /* Center the marker */
            pointer-events: none;
            z-index: 1000;
        }
        
        .atom {
            position: absolute !important;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 11px;
            color: white;
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        button {
            background: #4ecdc4;
            color: black;
            border: none;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        button:hover {
            background: #ffe66d;
        }
        
        #log {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
            font-size: 11px;
        }
    </style>
</head>
<body>
    <h1>üîç Coordinate Debug Test</h1>
    
    <div id="container">
        <div class="panel">
            <h3>Controls</h3>
            <button onclick="selectElement('H', '#ffffff')">H - Hydrogen</button>
            <button onclick="selectElement('C', '#909090')">C - Carbon</button>
            <button onclick="clearMarkers()">Clear Markers</button>
            <button onclick="clearAll()">Clear Everything</button>
        </div>
        
        <div class="panel" id="center-panel">
            <div id="level-info">
                <h2>Click canvas to test coordinates</h2>
                <p>Red dots = exact click position</p>
                <p>Colored circles = atoms (should center on red dots)</p>
            </div>
            <div id="canvas"></div>
        </div>
        
        <div class="panel">
            <h3>Debug Log</h3>
            <div id="log"></div>
        </div>
    </div>
    
    <script>
        let selectedElement = null;
        let selectedColor = null;
        
        const canvas = document.getElementById('canvas');
        const log = document.getElementById('log');
        
        function addLog(msg) {
            const time = new Date().toLocaleTimeString();
            log.innerHTML = `<div>[${time}] ${msg}</div>` + log.innerHTML;
        }
        
        function selectElement(el, color) {
            selectedElement = el;
            selectedColor = color;
            addLog(`Selected: ${el}`);
        }
        
        function clearMarkers() {
            document.querySelectorAll('.debug-marker').forEach(m => m.remove());
            addLog('Markers cleared');
        }
        
        function clearAll() {
            canvas.innerHTML = '';
            addLog('Everything cleared');
        }
        
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            
            addLog('========================================');
            addLog(`Event: clientX=${e.clientX}, clientY=${e.clientY}`);
            addLog(`Canvas: left=${rect.left}, top=${rect.top}, width=${rect.width}, height=${rect.height}`);
            
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            addLog(`Calculated: x=${x}, y=${y}`);
            
            // Add red marker at EXACT click position
            const marker = document.createElement('div');
            marker.className = 'debug-marker';
            marker.style.left = x + 'px';
            marker.style.top = y + 'px';
            canvas.appendChild(marker);
            
            addLog(`Marker placed at: ${x}, ${y}`);
            
            // If element selected, place atom
            if (selectedElement) {
                const atom = document.createElement('div');
                atom.className = 'atom';
                
                // Center atom on click point (atom is 32px, so offset by 16px)
                const atomLeft = x - 16;
                const atomTop = y - 16;
                
                atom.style.left = atomLeft + 'px';
                atom.style.top = atomTop + 'px';
                atom.style.backgroundColor = selectedColor;
                atom.textContent = selectedElement;
                
                canvas.appendChild(atom);
                
                addLog(`Atom placed: left=${atomLeft}, top=${atomTop}`);
                
                // Verify actual position
                setTimeout(() => {
                    const atomRect = atom.getBoundingClientRect();
                    const canvasRect = canvas.getBoundingClientRect();
                    const actualX = atomRect.left - canvasRect.left + 16; // Add back center offset
                    const actualY = atomRect.top - canvasRect.top + 16;
                    addLog(`Atom actual center: x=${actualX.toFixed(1)}, y=${actualY.toFixed(1)}`);
                    addLog(`Difference: dx=${Math.abs(actualX - x).toFixed(1)}, dy=${Math.abs(actualY - y).toFixed(1)}`);
                }, 0);
            } else {
                addLog('No element selected!');
            }
            
            addLog('========================================');
        });
        
        addLog('Test ready. Select an element, then click canvas.');
        addLog('Red dots show exact click position.');
        addLog('Atoms should be centered on red dots.');
    </script>
</body>
</html>
