<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MolMed - Molecular Medicine Education Platform</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Playfair+Display:wght@700;900&display=swap');
        
        :root {
            --primary: #0077be;
            --secondary: #00a86b;
            --accent: #ff6b6b;
            --bg-dark: #0a1628;
            --bg-medium: #1a2a3e;
            --bg-light: #2a3f5f;
            --text-primary: #ffffff;
            --text-secondary: #b8c5d6;
            --success: #4ecdc4;
            --warning: #ffe66d;
            --danger: #ff6b6b;
            --info: #a8dadc;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'JetBrains Mono', monospace;
            background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-medium) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Animated background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(0, 119, 190, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 168, 107, 0.1) 0%, transparent 50%);
            animation: pulse 15s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 0.8; }
        }
        
        .container {
            position: relative;
            z-index: 1;
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header */
        header {
            text-align: center;
            padding: 40px 20px;
            background: rgba(26, 42, 62, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            margin-bottom: 30px;
            border: 2px solid rgba(0, 119, 190, 0.3);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            font-family: 'Playfair Display', serif;
            font-size: 4em;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            letter-spacing: -2px;
        }
        
        .tagline {
            font-size: 1.2em;
            color: var(--text-secondary);
            font-weight: 400;
        }
        
        /* Mode Selection */
        .mode-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .mode-card {
            background: rgba(26, 42, 62, 0.9);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .mode-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .mode-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 10px 30px rgba(0, 119, 190, 0.3);
        }
        
        .mode-card:hover::before {
            opacity: 0.1;
        }
        
        .mode-card.active {
            border-color: var(--secondary);
            background: rgba(0, 168, 107, 0.1);
        }
        
        .mode-card-content {
            position: relative;
            z-index: 1;
        }
        
        .mode-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }
        
        .mode-title {
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--text-primary);
        }
        
        .mode-description {
            color: var(--text-secondary);
            line-height: 1.6;
        }
        
        /* Main Content Area */
        .content-area {
            background: rgba(26, 42, 62, 0.9);
            border-radius: 20px;
            padding: 40px;
            min-height: 600px;
            border: 2px solid rgba(0, 119, 190, 0.2);
            display: none;
        }
        
        .content-area.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Biomarker Grid */
        .biomarker-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .biomarker-card {
            background: rgba(42, 63, 95, 0.6);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid rgba(0, 119, 190, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .biomarker-card:hover {
            transform: scale(1.05);
            border-color: var(--secondary);
            box-shadow: 0 5px 20px rgba(0, 168, 107, 0.3);
        }
        
        .biomarker-name {
            font-size: 1.2em;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--text-primary);
        }
        
        .disease-scores {
            margin-top: 10px;
        }
        
        .score-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 8px 0;
        }
        
        .score-label {
            font-size: 0.85em;
            color: var(--text-secondary);
            width: 120px;
        }
        
        .score-value {
            flex: 1;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin: 0 10px;
            overflow: hidden;
        }
        
        .score-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .score-number {
            font-size: 0.85em;
            min-width: 40px;
            text-align: right;
        }
        
        /* Molecular Viewer */
        .molecular-viewer {
            background: rgba(10, 22, 40, 0.8);
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            border: 2px solid rgba(0, 119, 190, 0.3);
        }
        
        .molecule-canvas {
            width: 100%;
            height: 400px;
            background: radial-gradient(circle, rgba(0, 119, 190, 0.1), transparent);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .molecule-structure {
            position: relative;
            width: 300px;
            height: 300px;
        }
        
        .atom {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
            box-shadow: 0 0 20px currentColor;
            animation: float 3s ease-in-out infinite;
        }
        
        .bond {
            position: absolute;
            background: rgba(255, 255, 255, 0.3);
            height: 3px;
            transform-origin: left center;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        /* Diagnostic Mode */
        .patient-card {
            background: rgba(42, 63, 95, 0.8);
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 5px solid var(--primary);
        }
        
        .patient-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .info-item {
            display: flex;
            flex-direction: column;
        }
        
        .info-label {
            color: var(--text-secondary);
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        
        .info-value {
            font-size: 1.2em;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .biomarker-results {
            margin-top: 30px;
        }
        
        .result-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            background: rgba(10, 22, 40, 0.5);
            border-radius: 8px;
            border-left: 3px solid transparent;
        }
        
        .result-row.abnormal {
            border-left-color: var(--accent);
            background: rgba(255, 107, 107, 0.1);
        }
        
        .result-name {
            font-weight: 700;
        }
        
        .result-value {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .result-number {
            font-size: 1.2em;
            font-weight: 700;
        }
        
        .reference-range {
            color: var(--text-secondary);
            font-size: 0.85em;
        }
        
        /* Buttons */
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 119, 190, 0.4);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* Educational Content */
        .edu-pathway {
            background: linear-gradient(135deg, rgba(0, 119, 190, 0.1), rgba(0, 168, 107, 0.1));
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px solid rgba(0, 119, 190, 0.3);
        }
        
        .pathway-step {
            display: flex;
            align-items: flex-start;
            margin: 20px 0;
            padding: 20px;
            background: rgba(26, 42, 62, 0.6);
            border-radius: 10px;
            position: relative;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2em;
            margin-right: 20px;
            flex-shrink: 0;
        }
        
        .step-content h3 {
            margin-bottom: 10px;
            color: var(--text-primary);
        }
        
        .step-content p {
            color: var(--text-secondary);
            line-height: 1.6;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background: var(--bg-medium);
            padding: 40px;
            border-radius: 20px;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            border: 2px solid var(--primary);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 2em;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .close-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(90deg);
        }
        
        /* Status badges */
        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 700;
            margin-left: 10px;
        }
        
        .badge-high { background: rgba(255, 107, 107, 0.2); color: var(--accent); }
        .badge-normal { background: rgba(78, 205, 196, 0.2); color: var(--success); }
        .badge-low { background: rgba(255, 230, 109, 0.2); color: var(--warning); }
        
        /* Responsive */
        @media (max-width: 768px) {
            h1 { font-size: 2.5em; }
            .mode-selector { grid-template-columns: 1fr; }
            .content-area { padding: 20px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üß¨ MolMed</h1>
            <p class="tagline">Molecular Medicine Education Platform</p>
            <p class="tagline" style="font-size: 0.9em; margin-top: 10px;">From Molecules to Medicine: Learn Chemistry That Saves Lives</p>
        </header>

        <!-- Mode Selection -->
        <div class="mode-selector">
            <div class="mode-card" onclick="selectMode('clinical')">
                <div class="mode-card-content">
                    <div class="mode-icon">üî¨</div>
                    <div class="mode-title">Clinical Chemistry</div>
                    <div class="mode-description">Explore biomarker molecules and their clinical significance</div>
                </div>
            </div>
            
            <div class="mode-card" onclick="selectMode('diagnostic')">
                <div class="mode-card-content">
                    <div class="mode-icon">‚öïÔ∏è</div>
                    <div class="mode-title">Doctor Mode</div>
                    <div class="mode-description">Diagnose diseases from biomarker patterns</div>
                </div>
            </div>
            
            <div class="mode-card" onclick="selectMode('pathway')">
                <div class="mode-card-content">
                    <div class="mode-icon">üéì</div>
                    <div class="mode-title">Learning Pathway</div>
                    <div class="mode-description">Complete journey: Molecule ‚Üí Biomarker ‚Üí Diagnosis</div>
                </div>
            </div>
        </div>

        <!-- Clinical Chemistry Mode -->
        <div id="clinical-mode" class="content-area">
            <h2 style="margin-bottom: 20px; font-size: 2em;">üî¨ Clinical Chemistry Explorer</h2>
            <p style="color: var(--text-secondary); margin-bottom: 30px;">Click on any biomarker to see its molecular structure and clinical significance</p>
            <div id="biomarker-grid" class="biomarker-grid"></div>
        </div>

        <!-- Diagnostic Mode -->
        <div id="diagnostic-mode" class="content-area">
            <h2 style="margin-bottom: 20px; font-size: 2em;">‚öïÔ∏è Doctor Mode: Clinical Diagnosis</h2>
            <div id="patient-cases"></div>
        </div>

        <!-- Learning Pathway Mode -->
        <div id="pathway-mode" class="content-area">
            <h2 style="margin-bottom: 20px; font-size: 2em;">üéì Learning Pathway</h2>
            <div id="learning-content"></div>
        </div>

        <!-- Biomarker Detail Modal -->
        <div id="biomarker-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modal-title"></h2>
                    <button class="close-btn" onclick="closeModal()">&times;</button>
                </div>
                <div id="modal-body"></div>
            </div>
        </div>
    </div>

    <script>
        // Biomarker data embedded
        const BIOMARKERS = {
            "Hemoglobin": {
                name: "Hemoglobin",
                scores: { anemia: 0.49, healthy: 0.58, diabetes: 0.62, thalassemia: 0.64, thrombocytopenia: 0.57 },
                normalRange: "13.5-17.5 g/dL (M), 12-15.5 g/dL (F)",
                description: "Oxygen-carrying protein in red blood cells",
                clinicalSignificance: "Low hemoglobin indicates anemia, which can result from blood loss, nutritional deficiencies, or chronic diseases.",
                molecule: {
                    formula: "C2952H4664N812O832S8Fe4",
                    structure: "Complex protein with 4 heme groups",
                    atoms: [
                        { element: "Fe", x: 150, y: 150, color: "#8B4513" },
                        { element: "N", x: 120, y: 120, color: "#0066cc" },
                        { element: "N", x: 180, y: 120, color: "#0066cc" },
                        { element: "N", x: 120, y: 180, color: "#0066cc" },
                        { element: "N", x: 180, y: 180, color: "#0066cc" }
                    ]
                }
            },
            "Glucose": {
                name: "Glucose",
                scores: { anemia: 0.36, healthy: 0.46, diabetes: 0.45, thalassemia: 0.33, thrombocytopenia: 0.49 },
                normalRange: "70-100 mg/dL (fasting)",
                description: "Primary energy source for cells",
                clinicalSignificance: "Elevated glucose is the hallmark of diabetes. Chronic hyperglycemia leads to vascular damage.",
                molecule: {
                    formula: "C6H12O6",
                    structure: "Six-carbon sugar ring",
                    atoms: [
                        { element: "C", x: 150, y: 100, color: "#666666" },
                        { element: "C", x: 190, y: 120, color: "#666666" },
                        { element: "C", x: 190, y: 170, color: "#666666" },
                        { element: "C", x: 150, y: 190, color: "#666666" },
                        { element: "C", x: 110, y: 170, color: "#666666" },
                        { element: "O", x: 110, y: 120, color: "#cc0000" }
                    ]
                }
            },
            "Cholesterol": {
                name: "Cholesterol",
                scores: { anemia: 0.44, healthy: 0.46, diabetes: 0.46, thalassemia: 0.40, thrombocytopenia: 0.43 },
                normalRange: "<200 mg/dL (total)",
                description: "Essential lipid for cell membranes and hormones",
                clinicalSignificance: "High cholesterol increases risk of atherosclerosis and cardiovascular disease.",
                molecule: {
                    formula: "C27H46O",
                    structure: "Steroid with hydroxyl group",
                    atoms: [
                        { element: "C", x: 150, y: 150, color: "#666666" },
                        { element: "C", x: 120, y: 130, color: "#666666" },
                        { element: "C", x: 180, y: 130, color: "#666666" },
                        { element: "C", x: 120, y: 170, color: "#666666" },
                        { element: "C", x: 180, y: 170, color: "#666666" },
                        { element: "O", x: 150, y: 110, color: "#cc0000" }
                    ]
                }
            },
            "HbA1c": {
                name: "HbA1c",
                scores: { anemia: 0.49, healthy: 0.51, diabetes: 0.59, thalassemia: 0.41, thrombocytopenia: 0.51 },
                normalRange: "<5.7% (normal), 5.7-6.4% (prediabetes), >6.5% (diabetes)",
                description: "Glycated hemoglobin - shows 3-month average blood sugar",
                clinicalSignificance: "Gold standard for monitoring long-term diabetes control. Reflects average glucose over 2-3 months.",
                molecule: {
                    formula: "Hemoglobin + Glucose",
                    structure: "Hemoglobin with glucose attached",
                    atoms: [
                        { element: "Fe", x: 150, y: 150, color: "#8B4513" },
                        { element: "C", x: 200, y: 150, color: "#FFD700" },
                        { element: "N", x: 130, y: 130, color: "#0066cc" }
                    ]
                }
            },
            "Troponin": {
                name: "Troponin",
                scores: { anemia: 0.40, healthy: 0.42, diabetes: 0.60, thalassemia: 0.40, thrombocytopenia: 0.52 },
                normalRange: "<0.04 ng/mL",
                description: "Cardiac muscle protein released during heart damage",
                clinicalSignificance: "Elevated troponin is the gold standard for diagnosing heart attacks (myocardial infarction).",
                molecule: {
                    formula: "Complex protein",
                    structure: "Regulatory protein in cardiac muscle",
                    atoms: [
                        { element: "N", x: 150, y: 150, color: "#0066cc" },
                        { element: "C", x: 120, y: 130, color: "#666666" },
                        { element: "C", x: 180, y: 130, color: "#666666" },
                        { element: "O", x: 150, y: 110, color: "#cc0000" }
                    ]
                }
            },
            "Creatinine": {
                name: "Creatinine",
                scores: { anemia: 0.46, healthy: 0.49, diabetes: 0.56, thalassemia: 0.43, thrombocytopenia: 0.46 },
                normalRange: "0.6-1.2 mg/dL",
                description: "Waste product from muscle metabolism",
                clinicalSignificance: "Elevated creatinine indicates kidney dysfunction. Used to calculate GFR (kidney function).",
                molecule: {
                    formula: "C4H7N3O",
                    structure: "Small nitrogen-containing compound",
                    atoms: [
                        { element: "C", x: 150, y: 150, color: "#666666" },
                        { element: "N", x: 130, y: 130, color: "#0066cc" },
                        { element: "N", x: 170, y: 130, color: "#0066cc" },
                        { element: "O", x: 150, y: 110, color: "#cc0000" }
                    ]
                }
            }
        };

        const PATIENT_CASES = [
            {
                id: 1,
                name: "Maria Rodriguez",
                age: 42,
                gender: "Female",
                chiefComplaint: "Fatigue, weakness, pale skin for 3 weeks",
                results: {
                    "Hemoglobin": { value: 8.2, unit: "g/dL", normal: "12-15.5", status: "low" },
                    "RBC": { value: 3.1, unit: "M/ŒºL", normal: "4.0-5.5", status: "low" },
                    "MCV": { value: 68, unit: "fL", normal: "80-100", status: "low" },
                    "Iron": { value: 22, unit: "Œºg/dL", normal: "50-170", status: "low" }
                },
                diagnosis: "Iron Deficiency Anemia",
                explanation: "Low hemoglobin + low MCV + low iron = classic iron deficiency anemia. Patient likely has inadequate dietary iron or chronic blood loss."
            },
            {
                id: 2,
                name: "James Chen",
                age: 58,
                gender: "Male",
                chiefComplaint: "Increased thirst, frequent urination, blurred vision",
                results: {
                    "Glucose": { value: 245, unit: "mg/dL", normal: "70-100", status: "high" },
                    "HbA1c": { value: 9.2, unit: "%", normal: "<5.7", status: "high" },
                    "Cholesterol": { value: 245, unit: "mg/dL", normal: "<200", status: "high" },
                    "Triglycerides": { value: 320, unit: "mg/dL", normal: "<150", status: "high" }
                },
                diagnosis: "Type 2 Diabetes Mellitus",
                explanation: "Elevated glucose + elevated HbA1c (>6.5%) = confirmed diabetes. Also shows dyslipidemia, common in diabetic patients."
            },
            {
                id: 3,
                name: "Robert Williams",
                age: 65,
                gender: "Male",
                chiefComplaint: "Severe chest pain, shortness of breath",
                results: {
                    "Troponin": { value: 2.5, unit: "ng/mL", normal: "<0.04", status: "high" },
                    "CK-MB": { value: 45, unit: "U/L", normal: "<25", status: "high" },
                    "BNP": { value: 850, unit: "pg/mL", normal: "<100", status: "high" }
                },
                diagnosis: "Acute Myocardial Infarction (Heart Attack)",
                explanation: "Dramatically elevated troponin is diagnostic for MI. Troponin is released when cardiac muscle cells are damaged."
            }
        ];

        let currentMode = null;

        function selectMode(mode) {
            // Update UI
            document.querySelectorAll('.mode-card').forEach(card => card.classList.remove('active'));
            document.querySelectorAll('.content-area').forEach(area => area.classList.remove('active'));
            
            event.currentTarget.classList.add('active');
            document.getElementById(`${mode}-mode`).classList.add('active');
            
            currentMode = mode;
            
            // Load content for selected mode
            if (mode === 'clinical') loadClinicalMode();
            if (mode === 'diagnostic') loadDiagnosticMode();
            if (mode === 'pathway') loadPathwayMode();
        }

        function loadClinicalMode() {
            const grid = document.getElementById('biomarker-grid');
            grid.innerHTML = '';
            
            Object.values(BIOMARKERS).forEach(biomarker => {
                const card = document.createElement('div');
                card.className = 'biomarker-card';
                card.onclick = () => showBiomarkerDetail(biomarker);
                
                card.innerHTML = `
                    <div class="biomarker-name">${biomarker.name}</div>
                    <div style="font-size: 0.85em; color: var(--text-secondary); margin-bottom: 10px;">${biomarker.description}</div>
                    <div class="disease-scores">
                        ${createScoreBar('Anemia', biomarker.scores.anemia)}
                        ${createScoreBar('Diabetes', biomarker.scores.diabetes)}
                        ${createScoreBar('Thalassemia', biomarker.scores.thalassemia)}
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        function createScoreBar(label, score) {
            const percentage = (score * 100).toFixed(0);
            return `
                <div class="score-bar">
                    <div class="score-label">${label}</div>
                    <div class="score-value">
                        <div class="score-fill" style="width: ${percentage}%"></div>
                    </div>
                    <div class="score-number">${percentage}%</div>
                </div>
            `;
        }

        function showBiomarkerDetail(biomarker) {
            const modal = document.getElementById('biomarker-modal');
            const title = document.getElementById('modal-title');
            const body = document.getElementById('modal-body');
            
            title.textContent = biomarker.name;
            
            body.innerHTML = `
                <div class="molecular-viewer">
                    <h3 style="margin-bottom: 20px;">Molecular Structure</h3>
                    <div class="molecule-canvas">
                        <div class="molecule-structure" id="molecule-${biomarker.name.replace(/\s+/g, '-')}"></div>
                    </div>
                    <div style="text-align: center; margin-top: 15px; color: var(--text-secondary);">
                        Formula: ${biomarker.molecule.formula}
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3 style="margin-bottom: 15px;">Clinical Information</h3>
                    <div style="background: rgba(10, 22, 40, 0.5); padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                        <div style="color: var(--text-secondary); margin-bottom: 5px;">Normal Range</div>
                        <div style="font-size: 1.2em; font-weight: 700;">${biomarker.normalRange}</div>
                    </div>
                    
                    <div style="background: rgba(10, 22, 40, 0.5); padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                        <div style="color: var(--text-secondary); margin-bottom: 5px;">Description</div>
                        <div style="line-height: 1.6;">${biomarker.description}</div>
                    </div>
                    
                    <div style="background: rgba(0, 168, 107, 0.1); padding: 20px; border-radius: 10px; border-left: 4px solid var(--secondary);">
                        <div style="color: var(--secondary); margin-bottom: 5px; font-weight: 700;">Clinical Significance</div>
                        <div style="line-height: 1.6;">${biomarker.clinicalSignificance}</div>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3 style="margin-bottom: 15px;">Disease Relevance</h3>
                    ${createScoreBar('Anemia', biomarker.scores.anemia)}
                    ${createScoreBar('Healthy Baseline', biomarker.scores.healthy)}
                    ${createScoreBar('Diabetes', biomarker.scores.diabetes)}
                    ${createScoreBar('Thalassemia', biomarker.scores.thalassemia)}
                    ${createScoreBar('Thrombocytopenia', biomarker.scores.thrombocytopenia)}
                </div>
            `;
            
            modal.classList.add('active');
            
            // Render molecule after modal is shown
            setTimeout(() => renderMolecule(biomarker), 100);
        }

        function renderMolecule(biomarker) {
            const container = document.getElementById(`molecule-${biomarker.name.replace(/\s+/g, '-')}`);
            if (!container) return;
            
            container.innerHTML = '';
            
            // Draw atoms
            biomarker.molecule.atoms.forEach((atom, i) => {
                const atomEl = document.createElement('div');
                atomEl.className = 'atom';
                atomEl.style.left = `${atom.x - 20}px`;
                atomEl.style.top = `${atom.y - 20}px`;
                atomEl.style.background = atom.color;
                atomEl.style.animationDelay = `${i * 0.1}s`;
                atomEl.textContent = atom.element;
                container.appendChild(atomEl);
            });
            
            // Draw bonds
            const atoms = biomarker.molecule.atoms;
            for (let i = 0; i < atoms.length - 1; i++) {
                const bond = document.createElement('div');
                bond.className = 'bond';
                
                const x1 = atoms[i].x;
                const y1 = atoms[i].y;
                const x2 = atoms[i + 1].x;
                const y2 = atoms[i + 1].y;
                
                const length = Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
                const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
                
                bond.style.left = `${x1}px`;
                bond.style.top = `${y1}px`;
                bond.style.width = `${length}px`;
                bond.style.transform = `rotate(${angle}deg)`;
                
                container.appendChild(bond);
            }
        }

        function loadDiagnosticMode() {
            const container = document.getElementById('patient-cases');
            container.innerHTML = '';
            
            PATIENT_CASES.forEach(patient => {
                const caseEl = document.createElement('div');
                caseEl.className = 'patient-card';
                
                const resultsHTML = Object.entries(patient.results).map(([test, data]) => `
                    <div class="result-row ${data.status !== 'normal' ? 'abnormal' : ''}">
                        <div class="result-name">${test}</div>
                        <div class="result-value">
                            <div class="result-number">${data.value} ${data.unit}</div>
                            <div class="reference-range">Normal: ${data.normal}</div>
                            <span class="badge badge-${data.status}">${data.status.toUpperCase()}</span>
                        </div>
                    </div>
                `).join('');
                
                caseEl.innerHTML = `
                    <h3 style="margin-bottom: 20px; font-size: 1.5em;">Case #${patient.id}: ${patient.name}</h3>
                    
                    <div class="patient-info">
                        <div class="info-item">
                            <div class="info-label">Age</div>
                            <div class="info-value">${patient.age} years</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Gender</div>
                            <div class="info-value">${patient.gender}</div>
                        </div>
                        <div class="info-item" style="grid-column: span 2;">
                            <div class="info-label">Chief Complaint</div>
                            <div class="info-value">${patient.chiefComplaint}</div>
                        </div>
                    </div>
                    
                    <div class="biomarker-results">
                        <h4 style="margin-bottom: 15px;">Laboratory Results</h4>
                        ${resultsHTML}
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <button class="btn btn-primary" onclick="revealDiagnosis(${patient.id})">Show Diagnosis</button>
                        <div id="diagnosis-${patient.id}" style="display: none; margin-top: 20px; padding: 20px; background: rgba(0, 168, 107, 0.1); border-radius: 10px; border-left: 4px solid var(--secondary);">
                            <h4 style="color: var(--secondary); margin-bottom: 10px;">Diagnosis: ${patient.diagnosis}</h4>
                            <p style="line-height: 1.6; color: var(--text-secondary);">${patient.explanation}</p>
                        </div>
                    </div>
                `;
                
                container.appendChild(caseEl);
            });
        }

        function revealDiagnosis(caseId) {
            const diagnosisEl = document.getElementById(`diagnosis-${caseId}`);
            if (diagnosisEl) {
                diagnosisEl.style.display = 'block';
                diagnosisEl.style.animation = 'fadeIn 0.5s ease';
            }
        }

        function loadPathwayMode() {
            const container = document.getElementById('learning-content');
            
            container.innerHTML = `
                <div class="edu-pathway">
                    <h3 style="font-size: 1.8em; margin-bottom: 30px;">Complete Learning Journey: Hemoglobin</h3>
                    
                    <div class="pathway-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h3>üß¨ Molecular Level: Build Hemoglobin</h3>
                            <p>Hemoglobin is a complex protein made of 4 polypeptide chains (2 alpha, 2 beta), each containing a heme group with an iron (Fe) atom at its center. The iron binds oxygen molecules.</p>
                            <p style="margin-top: 10px;"><strong>Formula:</strong> C2952H4664N812O832S8Fe4</p>
                            <button class="btn btn-secondary" onclick="showBiomarkerDetail(BIOMARKERS['Hemoglobin'])" style="margin-top: 15px;">View Molecular Structure</button>
                        </div>
                    </div>
                    
                    <div class="pathway-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h3>üî¨ Biomarker Level: Blood Test</h3>
                            <p>Hemoglobin is measured in a Complete Blood Count (CBC). Normal ranges are 13.5-17.5 g/dL for men and 12-15.5 g/dL for women.</p>
                            <p style="margin-top: 10px;"><strong>What it measures:</strong> The concentration of hemoglobin in your blood, which determines oxygen-carrying capacity.</p>
                            <p style="margin-top: 10px;"><strong>Why it matters:</strong> Too little = anemia (fatigue, weakness). Too much = polycythemia (thick blood, clotting risk).</p>
                        </div>
                    </div>
                    
                    <div class="pathway-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h3>‚öïÔ∏è Clinical Level: Diagnosis</h3>
                            <p>Low hemoglobin (anemia) can result from:</p>
                            <ul style="margin-top: 10px; margin-left: 20px; line-height: 1.8; color: var(--text-secondary);">
                                <li><strong>Iron deficiency:</strong> Not enough iron to make heme groups</li>
                                <li><strong>Vitamin B12/Folate deficiency:</strong> Impaired red blood cell production</li>
                                <li><strong>Chronic disease:</strong> Inflammation interferes with iron metabolism</li>
                                <li><strong>Blood loss:</strong> Trauma, menstruation, GI bleeding</li>
                                <li><strong>Genetic:</strong> Thalassemia, sickle cell disease</li>
                            </ul>
                            <button class="btn btn-primary" style="margin-top: 20px;" onclick="selectMode('diagnostic'); loadDiagnosticMode();">Practice with Real Cases</button>
                        </div>
                    </div>
                    
                    <div class="pathway-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h3>üíä Treatment & Management</h3>
                            <p><strong>Iron deficiency anemia:</strong> Iron supplements (ferrous sulfate), dietary changes (red meat, spinach, fortified cereals)</p>
                            <p style="margin-top: 10px;"><strong>Monitoring:</strong> Recheck hemoglobin in 2-4 weeks. Should see improvement.</p>
                            <p style="margin-top: 10px;"><strong>Prevention:</strong> Adequate dietary iron (18mg/day for women, 8mg/day for men)</p>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 40px;">
                    <h3 style="font-size: 1.5em; margin-bottom: 20px;">More Learning Pathways</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        ${createPathwayCard('Glucose', 'Diabetes', 'üç¨')}
                        ${createPathwayCard('Cholesterol', 'Heart Disease', '‚ù§Ô∏è')}
                        ${createPathwayCard('Troponin', 'Heart Attack', 'üíî')}
                    </div>
                </div>
            `;
        }

        function createPathwayCard(biomarker, condition, icon) {
            return `
                <div style="background: rgba(42, 63, 95, 0.6); padding: 25px; border-radius: 12px; border: 2px solid rgba(0, 119, 190, 0.3); cursor: pointer;" 
                     onclick="alert('Full ${biomarker} pathway coming soon! This will include:\\n\\n1. Molecular structure of ${biomarker}\\n2. ${biomarker} blood test interpretation\\n3. ${condition} diagnosis\\n4. Treatment guidelines')">
                    <div style="font-size: 3em; margin-bottom: 10px;">${icon}</div>
                    <div style="font-size: 1.3em; font-weight: 700; margin-bottom: 10px;">${biomarker}</div>
                    <div style="color: var(--text-secondary);">Learn about ${condition}</div>
                </div>
            `;
        }

        function closeModal() {
            document.getElementById('biomarker-modal').classList.remove('active');
        }

        // Close modal on outside click
        document.getElementById('biomarker-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Auto-load first mode on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.querySelector('.mode-card').click();
            }, 500);
        });
    </script>
</body>
</html>
